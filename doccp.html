<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Docs Components SDK</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://lf1-cdn-tos.bytegoofy.com/goofy/lark/op/h5-js-sdk-1.5.16.js"></script>
    <script src="https://sf1-scmcdn-cn.feishucdn.com/obj/feishu-static/docComponentSdk/lib/1.0.13.js"></script>
    <script src="https://unpkg.com/vconsole/dist/vconsole.min.js"></script>
    <script src='https://lf-package-cn.feishucdn.com/obj/feishu-static/op/fe/devtools_frontend/remote-debug-0.0.1-alpha.6.js'></script>
    <script>
        var vConsole = new window.VConsole();
    </script>
</head>
<body>
Doc: <input id="doc_url"/> <button onclick="apiAuth()">Auth</button>

<div id="conent">
   
</div>


</body>
<script>
    var myComponent;
    function init(res){
       console.log("init res", res);
       const doc_url = $('#doc_url').val();
       myComponent = new window.DocComponentSdk({
        src: doc_url,
        mount: document.querySelector('#conent'),  // 将组件挂在到哪个元素上
        auth: {
          openId: "ou_3496ef3e71ad9e3161b7af9ea51514e3",
          signature: res.signature, // 签名
          appId:res.appid,     // 应用 appId
          timestamp: res.timestamp, // 时间戳（毫秒[number]）
          nonceStr: res.noncestr,  // 随机字符串
          url: res.url,       // 参与签名加密计算的url
          jsApiList: ['DocsComponent'], // 指定要使用的组件，请根据对应组件的开发文档填写。如云文档组件，填写['DocsComponent']
          size: {
              height: "800px"
          }
        },
        onAuthError: (error) => {
          console.error("认证错误:", error); // 输出错误详情
        },
        onError: (error) => {
          console.error("组件加载错误:", error); // 输出错误详情
        },
      });
      myComponent.start().then(() => {
          myComponent.setFeatureConfig({
            extensions: {
                like: {
                    "disable": true // 隐藏点赞
                },
                suiteNavBar:{
                     "disable": true
                }
            }
        });
      });
  
    }

    function destroy() {
      // 销毁组件
      myComponent.destroy()
    }
 
    function apiAuth() {
        console.log("start apiAuth");
        const params = new URLSearchParams(window.location.search);
        const code = params.get('code');
        console.log("Auth code", code);
        
        const url = location.href.split("#")[0];
        console.log("接入方前端将需要鉴权的url发给接入方服务端,url为:", url);
        
        // 向接入方服务端发起请求，获取鉴权参数（appId、timestamp、nonceStr、signature）
        // 使用 fetch 获取 config 参数
        fetch("https://open.feishu.cn/anycross/trigger/callback/ODAzY2Y3ODBlNWEyNDY3NmNkMTQ4ZDY5NzY1N2RiZWQw", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ url, code })
        })
        .then(res => res.json())
        .then(res => {
            console.log(
                "接入方服务端返回给接入方前端的结果(前端调用config接口的所需参数):", res
            );
            init(res)
        });
    }
</script>
</html>
